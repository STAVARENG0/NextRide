<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NextRide | Cars for Sale</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<meta http-equiv="Cache-Control" content="no-store"/>
<style>
:root{ --teal:#0E3539; --ivory:#F2F0EA; --muted:#9EB3B2; --orange:#F07424; --card:#0b2326; }
*{box-sizing:border-box}
body{ margin:0; font-family:Poppins,system-ui,Arial,sans-serif; color:var(--ivory); background: var(--teal); min-height:100dvh; }
.wrap{max-width:1024px;margin:0 auto;padding:26px}
.card{ background:#0b2326; border-radius:26px; padding:28px 22px; border:1px solid rgba(255,255,255,.12); box-shadow:0 18px 42px rgba(0,0,0,.45), 0 0 26px rgba(14,53,57,.28); position:relative; }
header{text-align:center;margin-bottom:12px}
.subtitle{color:var(--muted);margin-top:0px;font-size:1rem;text-align:center}
.divider{height:2px;background:linear-gradient(90deg,transparent,var(--orange),transparent);margin:18px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:22px;align-items:stretch}
.car{ background:#102a2d; border:1px solid rgba(255,255,255,.08); border-radius:18px; overflow:hidden; box-shadow:0 10px 28px rgba(0,0,0,.28); display:flex;flex-direction:column; }
.car img{width:100%;aspect-ratio:4/3;object-fit:cover;background:#0b2326;display:block}
.car-body{padding:12px 14px 6px}
.car h3{margin:0 0 6px;font-weight:700;font-size:16px;color:var(--ivory);cursor:pointer;text-decoration:underline dotted transparent}
.car h3:hover{ text-decoration-color: rgba(255,255,255,.5) }
.meta{color:var(--muted);font-size:13px;line-height:1.4;margin-bottom:8px}
.price{font-weight:700;color:var(--ivory);margin-bottom:6px}
.cta{padding:12px 14px 14px;border-top:1px dashed rgba(255,255,255,.08)}
.btn{ display:block;width:100%;text-align:center;text-decoration:none;font-weight:700;padding:12px 14px;border-radius:28px;background:linear-gradient(90deg,var(--orange), #ffb37e);color:#102326; box-shadow:0 8px 20px rgba(240,116,36,.35); transition:transform .18s ease, filter .18s ease, box-shadow .18s ease; }
.btn:hover{transform:translateY(-1px);filter:brightness(1.03)}
.brand{display:flex;align-items:center;gap:12px;justify-content:center}
footer{color:var(--muted);text-align:center;font-size:12px;margin-top:16px}

/* MODAL */
#modal{ position:fixed; inset:0; display:none; place-items:center; z-index:9999; }
#modal.open{ display:grid }
#modal .overlay{ position:absolute; inset:0; background:rgba(0,0,0,.65); backdrop-filter: blur(2px); }
#modal .panel{ position:relative; width:min(96vw,980px); max-height:92vh; overflow:hidden; background:#0b2326; color:var(--ivory); border:1px solid rgba(255,255,255,.12); border-radius:18px; box-shadow:0 18px 42px rgba(0,0,0,.6); display:grid; grid-template-columns: 1.2fr 1fr; }
@media (max-width:860px){ #modal .panel{ grid-template-columns: 1fr; } }
#modal .gallery{ background:#0b2326; padding:10px; display:flex; flex-direction:column; }
#modal .hero-wrap{ position:relative; }
#modal .hero{ width:100%; aspect-ratio:4/3; object-fit:cover; border-radius:12px; background:#102a2d }
#thumbs{ display:flex; gap:8px; overflow:auto; padding:10px 0 }
#thumbs img{ width:80px; height:60px; object-fit:cover; border-radius:8px; opacity:.8; cursor:pointer; border:1px solid rgba(255,255,255,.12) }
#thumbs img.active{ opacity:1; outline:2px solid var(--orange) }
#modal .details{ padding:16px; overflow:auto }
#modal h2{ margin:0 0 8px; font-size:20px }
#modal .meta{ margin:8px 0; font-size:13px; color:var(--muted) }
#modal .price{ font-size:18px; margin:8px 0 12px; font-weight:700 }
#modal .desc{ font-size:14px; line-height:1.5; color:#dfe7e6; white-space:pre-wrap }
#modal .actions{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap }
#modal .btn.secondary{ background:#122f32; color:#fff; box-shadow:none }
#modal .close{ position:absolute; top:10px; right:10px; background:#122f32; color:#fff; border:0; border-radius:10px; padding:8px 10px; font-weight:700; cursor:pointer }
/* setas e contador */
#modal .nav{ position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,.45); border:0; color:#fff; font-size:26px; line-height:1; width:40px; height:40px; border-radius:50%; cursor:pointer; display:grid; place-items:center }
#modal .nav:hover{ filter:brightness(1.1) }
#modal .nav.prev{ left:10px }
#modal .nav.next{ right:10px }
#modal .counter{ position:absolute; top:10px; left:10px; background:rgba(0,0,0,.45); padding:4px 8px; border-radius:10px; font-size:12px; color:#fff }

/* AJUSTES MOBILE — v2 */
@media (max-width: 600px) {
  /* Painel ocupa a altura visível do dispositivo,
     inclusive em iOS/Android com barras dinâmicas */
  #modal .panel {
    width: 96vw;
    max-height: calc(100dvh - 20px);
    border-radius: 14px;
    overflow: hidden;
    display: flex;            /* coluna no mobile */
    flex-direction: column;
  }

  /* Hero retangular e limitado em altura */
  #modal .hero {
    aspect-ratio: 4/3;
    max-height: 56svh;        /* usa small viewport p/ evitar corte */
  }

  /* Setas sempre visíveis e com bom alvo de toque */
  #modal .nav {
    z-index: 5;
    width: clamp(32px, 9vw, 40px);
    height: clamp(32px, 9vw, 40px);
    font-size: clamp(20px, 6vw, 26px);
  }
  #modal .nav.prev { left: min(10px, 2.5vw); }
  #modal .nav.next { right: min(10px, 2.5vw); }

  /* Área de detalhes usa o restante da altura e rola */
  #modal .details {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 16px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 16px);
  }

  /* Botões "grudados" no rodapé do painel,
     sempre 100% visíveis e com respiro p/ safe area */
  #modal .actions {
    position: sticky;
    bottom: 0;
    padding-top: 10px;
    padding-bottom: calc(env(safe-area-inset-bottom) + 10px);
    background: linear-gradient(180deg, rgba(11,35,38,0) 0%, #0b2326 45%);
  }

  /* Miniaturas com um pouco menos de altura p/ abrir espaço */
  #thumbs img { width: 72px; height: 52px; }

  /* Botão de fechar acima de tudo */
  #modal .close { z-index: 6; }
}

</style>
</head>
<body>
<div class="wrap">
 <div class="card">
  <header>
   <div class="brand" style="flex-direction:column;gap:8px;">
     <img src="logo.png" alt="Logo" style="max-width:220px;height:auto;display:block;margin:0 auto 2px;">
     <div class="subtitle"><span style="font-size:1.6rem;font-weight:600;color:var(--ivory)">Cars for Sale</span><br>Quality used cars • Ireland • Inquiries welcome</div>
    <div style="text-align:center; font-size:0.9rem; color:var(--muted); margin-top:6px;">
  Access also our car buy and sell groups via
</div>

<div style="display:flex; justify-content:center; gap:16px; flex-wrap:wrap; margin-top:12px;">
      <a href="https://chat.whatsapp.com/KSedyBxjEKd07OAC8AIJOz" target="_blank" rel="noopener"
         style="display:flex; align-items:center; gap:8px; padding:10px 16px; border-radius:28px;
                background:#25D366; color:#fff; font-weight:600; text-decoration:none;">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg"
             alt="WhatsApp" style="width:20px; height:20px; filter:invert(1);" />
        WhatsApp
      </a>

      <a href="https://www.facebook.com/groups/1065592052316610/" target="_blank" rel="noopener"
         style="display:flex; align-items:center; gap:8px; padding:10px 16px; border-radius:28px;
                background:#1877F2; color:#fff; font-weight:600; text-decoration:none;">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"
             alt="Facebook" style="width:20px; height:20px; filter:invert(1);" />
        Facebook
      </a>
    </div>

   </div>
   <a href="painel.html" class="btn" style="position:absolute; top:16px; right:16px; padding:8px 12px; border-radius:999px;background:linear-gradient(90deg,var(--muted), #cfd9d8); color:#0e2b2e; font-size:12px; width:auto; display:inline-block;text-decoration:none; box-shadow:0 6px 16px rgba(0,0,0,.24)">Admin</a>
  </header>

  <div class="divider"></div>

  <section class="grid" id="cars"></section>

  <div class="divider"></div>

  
  <footer>© <span id="year"></span></footer>
 </div>
</div>

<!-- MODAL STRUCTURE -->
<div id="modal" aria-hidden="true" role="dialog">
  <div class="overlay" data-close></div>
  <div class="panel" role="document">
    <button class="close" data-close>&times; Close</button>
    <div class="gallery">
      <div class="hero-wrap">
        <img id="hero" class="hero" alt="Car main photo" src=""/>
        <button class="nav prev" id="gPrev" aria-label="Anterior">‹</button>
        <button class="nav next" id="gNext" aria-label="Próxima">›</button>
        <div class="counter" id="mCount">0/0</div>
      </div>
      <div id="thumbs"></div>
    </div>
    <div class="details">
      <h2 id="mTitle">—</h2>
      <div id="mMeta" class="meta">—</div>
      <div id="mPrice" class="price">—</div>
      <div id="mDesc" class="desc">—</div>
      <div class="actions">
        <a id="mWhats" class="btn" target="_blank" rel="noopener">I'm interested</a>
        <a id="mCall" class="btn secondary" target="_blank" rel="noopener" style="display:none">Call</a>
      </div>
    </div>
  </div>
</div>

<script>
const WHATSAPP = "353876342891";
const PUBLIC_JSON = './cars.json';
const fmtEUR = n => new Intl.NumberFormat('en-IE',{style:'currency',currency:'EUR'}).format(Number(n||0));
const grid = document.getElementById('cars');
const modal = document.getElementById('modal');
const hero = document.getElementById('hero');
const thumbs = document.getElementById('thumbs');
const mTitle = document.getElementById('mTitle');
const mMeta = document.getElementById('mMeta');
const mPrice = document.getElementById('mPrice');
const mDesc = document.getElementById('mDesc');
const mWhats = document.getElementById('mWhats');
const mCall  = document.getElementById('mCall');
const gPrev  = document.getElementById('gPrev');
const gNext  = document.getElementById('gNext');
const mCount = document.getElementById('mCount');

function sanitizeList(list){
  if(!Array.isArray(list)) return [];
  return list.map(c => ({
    id: c.id || crypto.randomUUID(),
    titulo: c.titulo || c.title || '',
    marca: c.marca || c.brand || '',
    modelo: c.modelo || c.model || '',
    ano: c.ano || c.year || '',
    km: c.km || c.mileage || '',
    preco: c.preco || c.price || '',
    foto: c.foto || c.photo || c.image || '',
    desc: c.desc || c.description || '',
    contato: c.contato || c.contact || '',
    fotos: Array.isArray(c.fotos)?c.fotos : (Array.isArray(c.galeria)?c.galeria: (Array.isArray(c.gallery)?c.gallery: []))
  }));
}

async function readPublic(){
  try{
    const r = await fetch(PUBLIC_JSON + '?t=' + Date.now(), {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();
    return sanitizeList(data);
  }catch(e){
    return [];
  }
}

function buildMsg(c){
  const title = c.titulo || [c.marca, c.modelo].filter(Boolean).join(' ');
  const meta = [c.marca, c.modelo, c.ano?`Year ${c.ano}`:null, c.km?`${Number(c.km).toLocaleString('en-IE')} km`:null, c.preco?fmtEUR(c.preco):null].filter(Boolean).join(' • ');
  const text = `Hello! I'm interested in the ${title}.\n${meta}\nIs it still available?`;
  return encodeURIComponent(text);
}

let galleryImgs = [];
let galleryIndex = 0;
function setActiveThumb(i){
  thumbs.querySelectorAll('img').forEach((t,idx)=>{
    if(idx===i) t.classList.add('active'); else t.classList.remove('active');
  });
}
function showImage(i){
  if(!galleryImgs.length) return;
  galleryIndex = (i+galleryImgs.length) % galleryImgs.length;
  hero.src = galleryImgs[galleryIndex];
  setActiveThumb(galleryIndex);
  mCount.textContent = `${galleryIndex+1}/${galleryImgs.length}`;
}

function openModal(c){
  // Galeria: foto principal + demais fotos
  galleryImgs = [c.foto, ...(c.fotos||[])].filter(Boolean);
  if(!galleryImgs.length) galleryImgs = ['logo.png'];
  hero.src = galleryImgs[0]; hero.alt = c.titulo || 'Car photo';
  galleryIndex = 0; mCount.textContent = `1/${galleryImgs.length}`;
  thumbs.innerHTML = galleryImgs.map((src,i)=>`<img ${i===0?'class="active"':''} data-idx="${i}" src="${src}" alt="thumb ${i+1}">`).join('');
  thumbs.querySelectorAll('img').forEach(img=>{
    img.addEventListener('click', ()=>{ showImage(Number(img.dataset.idx)); });
  });

  // Detalhes
  mTitle.textContent = c.titulo || [c.marca, c.modelo].filter(Boolean).join(' ');
  mMeta.textContent = [c.ano?`Year ${c.ano}`:null, c.km?(`${Number(c.km).toLocaleString('en-IE')} km`):null, c.marca, c.modelo].filter(Boolean).join(' • ');
  mPrice.textContent = c.preco?fmtEUR(c.preco):'';
  mDesc.textContent = c.desc || '';
  mWhats.href = `https://wa.me/${WHATSAPP}?text=${buildMsg(c)}`;
  if(c.contato){ mCall.style.display='inline-block'; mCall.href = `tel:${c.contato.replace(/[^+\d]/g,'')}`; } else { mCall.style.display='none'; }

  modal.classList.add('open');
  modal.setAttribute('aria-hidden','false');
  document.body.style.overflow='hidden';
}
function closeModal(){
  modal.classList.remove('open');
  modal.setAttribute('aria-hidden','true');
  document.body.style.overflow='';
  thumbs.innerHTML='';
}
modal.addEventListener('click', (ev)=>{ if(ev.target.hasAttribute('data-close')) closeModal(); });
window.addEventListener('keydown', (ev)=>{
  if(ev.key==='Escape' && modal.classList.contains('open')) closeModal();
  if(!modal.classList.contains('open')) return;
  if(ev.key==='ArrowRight') showImage(galleryIndex+1);
  if(ev.key==='ArrowLeft')  showImage(galleryIndex-1);
});
if(gPrev) gPrev.addEventListener('click', ()=> showImage(galleryIndex-1));
if(gNext) gNext.addEventListener('click', ()=> showImage(galleryIndex+1));
(function(){
  let x0=null; const area=document.querySelector('#modal .hero-wrap');
  if(!area) return;
  area.addEventListener('touchstart', e=>{ x0 = e.touches?.[0]?.clientX ?? null; }, {passive:true});
  area.addEventListener('touchend', e=>{ if(x0==null) return; const dx = (e.changedTouches?.[0]?.clientX ?? x0) - x0; if(Math.abs(dx)>30){ if(dx<0) showImage(galleryIndex+1); else showImage(galleryIndex-1); } x0=null; }, {passive:true});
})();

function render(list){
  grid.innerHTML = '';
  if(!list.length){
    const div=document.createElement('div');div.className='meta';div.style.textAlign='center';div.style.padding='20px';
    div.innerHTML='No cars published yet.';
    grid.appendChild(div); return;
  }
  list.forEach((c, idx)=>{
    const el = document.createElement('article'); el.className='car';
    const img = document.createElement('img'); img.src = c.foto || 'logo.png'; img.alt = c.titulo || 'Car photo'; el.appendChild(img);
    const body = document.createElement('div'); body.className='car-body';
    const meta = [c.ano?`Year ${c.ano}`:null, c.km?(`${Number(c.km).toLocaleString('en-IE')} km`):null, c.marca, c.modelo].filter(Boolean).join(' • ');
    const titleText = c.titulo || (c.marca+' '+(c.modelo||''));
    body.innerHTML = `<h3 data-idx="${idx}">${titleText}</h3><div class="meta">${meta}</div><div class="price">${fmtEUR(c.preco)}</div>`;
    el.appendChild(body);
    const cta = document.createElement('div'); cta.className='cta';
    const a = document.createElement('a'); a.className='btn'; a.target='_blank'; a.rel='noopener';
    a.href = `https://wa.me/${WHATSAPP}?text=${buildMsg(c)}`; a.textContent = "I'm interested";
    cta.appendChild(a); el.appendChild(cta);
    grid.appendChild(el);
  });
  grid.querySelectorAll('h3[data-idx]').forEach(h=>{
    h.addEventListener('click', ()=>{
      const idx = Number(h.getAttribute('data-idx'));
      openModal(currentList[idx]);
    });
  });
}

let currentList = [];
(async function init(){
  currentList = await readPublic();
  render(currentList);
  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>
</body>
</html>